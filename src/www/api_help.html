<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>API Documentation - Monarch Bot</title>
        <link rel="icon" type="image/png" href="favicon.png" />
        <style type="text/css">
        /* {CSS} */
        </style>
    </head>
    <body class="bg">
        <div class="grid-container">
            <div class="index">
                <div class="index-inner">
                    <h2>Index:</h2>
                    <!-- Index Auto-generated by the python script -->
                    <!-- {INDEX} -->
                </div>
            </div>
            <div class="content">
                <div class="content-inner">
                    <h1>API Documentation</h1>

                    This API documentation should be accurate if it is not please visit the
                    <a href="/github">GitHub repository</a> and make an issue.

                    <p id="top"></p>
                    <h2 id="api">../api/</h2>
                    <ul>
                        <li>Returns this page :)</li>
                    </ul>

                    <h2 id="apiversion">../api/version</h2>
                    <h4>Check the server version</h4>
                    Request body should be null
                    <ul>
                        <li>Returns the server version i.e:</li>
                    </ul>
                    <blockquote>v1.0</blockquote>

                    <h2 id="apicheckauthkey">../api/checkauthkey</h2>
                    <h4>Checks you have the right auth key</h4>
                    Request body is auth token i.e:
                    <ul>
                        <blockquote>sampleauthtoken</blockquote>
                        <li>Returns 1 if the auth token is valid, 0 if not. i.e:</li>
                        <blockquote>valid=1</blockquote>
                        <li>If it is valid or</li>
                        <blockquote>valid=0</blockquote>
                        <li>If it is invalid</li>
                    </ul>
                    <h2 id="InvalidAuthTokens">Invalid Auth Tokens</h2>
                    -> Any of the below requests that have an invalid auth token will give an error with response code 401 and body of
                    <blockquote>invalid auth token</blockquote>
                    
                    <h2 id="InvalidCommands">Invalid Commands</h2>
                    <ul>
                        <li>Any invalid command will receive a 404 response.</li>
                        <li>At the moment there is no way to tell the exact error.</li>
                    </ul>
                    <blockquote>error 404</blockquote>

                    <h2 id="apicreategame">../api/creategame</h2>
                    <h4>Creates a game</h4>   
                    <ul>         
                        <li>Request body follows this format (case-sensitive):</li>

                        <blockquote>authtoken=token
                            gamename=name
                            password=password
                            playerCount=2/3/...
                            spectatorsAllowed=1/0
                            spectatorsNeedPassword=1/0
                            spectatorsCanChat=1/0
                            spectatorsCanSeeHands=1/0
                            onlyRegistered=1/0
                            playerDeckVerification=1/0</blockquote>

                        <li><b>The slot for the bot is automatically made so player count should be the amount of human players.</b></li>
                        <li>Bad lines are ignored</li>
                        <li>All games must have a password.</li>
                        <li>The request parser is case sensitive.</li>
                        <li>If player deck verification is enabled then players who are not allowed in the game are kick automatically and sent a message.</li>
                        <li>When players load an invalid deck the bot will say in chat that the deck is not expected and to contact a tournament organiser if this is a mistake.</li>
                        <li>If player deck verification is enabled then you must send the player and deck list in this format at the end of the request. For each player add a playerName and deckHash tag, if there is no deck verification for a player set their tag to *. If a player has no name then set their name to *.<b>The bot will not allow users called * to join a slot with * as the player name, even if that is intended. However most servers do not allow such a short name</b></li>
                        <li>There must be less than or equal to the player count amounts of player info blocks (below).</li>
                        <li>Any player infos that are not included are assumed to be empty slots.</li>
                        <li>If there the amount of player names and hashes are not equal then the request is invalid.</li>
                        <li>Player deck verification allows for 25 maximum players due to a fixed buffer size.</li>
                        <li>All of the player infos are truncated to their char limit</li>
                        <li>A player can have multiple deck hashes (up to 10 by default)</li>
                    
                        <blockquote>playerName=name (255 chars at most)
                        deckHash=8 characters that make up the deck hash</blockquote>
                        
                        <h4>Example Request</h4>
                        <blockquote>authtoken=token
                        gamename=name
                        password=password
                        playerCount=2
                        spectatctorsAllowed=1
                        spectatorsNeedPassword=1
                        spectatorsCanChat=0
                        spectatorsCanSeeHands=1
                        onlyRegistered=1
                        playerDeckVerification=1
                        playerName=test1
                        deckHash=gabf42fr
                        playerName=test2
                        deckHash=gabf42fr
                        deckHash=a678f6af</blockquote>
                        
                        <h4>Responses</h4>
                        <li>Returns the game id if the game is made; or error if it is not made. i.e:</li>
                        <blockquote>gameid=123456
                        replayName=replay-test-3.cor</blockquote>
                        if it is made or,
                        <blockquote>timeout error</blockquote>
                        if it is not made or,
                        <blockquote>invalid player info</blockquote>
                        if the player deck verification data is invalid
                    </ul>
                    <h2 id="apidisableplayerdeckverification">../api/disableplayerdeckverification</h2>
                    <h4>This endpoint will disable player deck verification for a specified game.</h4>
                    <ul>
                        <h4>Example Request</h4>
                        <blockquote>authtoken=token
                        gameid=123</blockquote>
                        
                        <li>Returns success if the operation was successful:</li>
                        <blockquote>success</blockquote>
                        <li>If the game cannot be found it returns:</li>
                        <blockquote>error game not found</blockquote>
                        <li>If the player deck verification is already disabled:</li>
                        <blockquote>already disabled</blockquote>
                    </ul>
                    <h2 id="apiupdateplayerinfo">../api/updateplayerinfo</h2>
                    <h4>Updates player info for a game</h4>
                    <ul>
                        <li>Only updates the player name, as updating the decks is open for abuse.</li>
                        <li>Request body should be in this format:</li>
                        <blockquote>authtoken=token
                        gameid=123456          
                        oldplayername=naughtius maximus
                        newplayername=biggus dickus</blockquote>
                        <li>Returns success if the operation was successful</li>
                        <blockquote>success</blockquote>
                        <li>If the game cannot be found it returns:</li>
                        <blockquote>error game not found</blockquote>
                        <li>If the bot cannot find a valid target</li>
                        <blockquote>error player not found</blockquote>
                        <li>If the game has no player deck verifcation enabled</li>
                        <blockquote>not enabled</blockquote>
                    </ul>
                    <h2 id="apikickplayer">../api/kickplayer</h2>
                    <h4>Kicks a player</h4>
                    <ul>
                        <li>Request body should be in this format:</li>
                        <blockquote>authtoken=token
                        gameid=id returned by creategame
                        target=player name</blockquote>
                        
                        <li>Response will be success if the bot issued the command.</li>
                        <blockquote>success</blockquote>
                        <li>If the player is not in the game then a response of error not found will be send</li>
                        <blockquote>error not found</blockquote>
                        
                        <li>At the moment the response from servatrice is ignored.</li>
                    </ul>
                    <h2 id="ReplayDownloads">Replay Downloads</h2>
                    <h3>../replay-%s-%d.cor</h3>
                    <h3>../${REPLAY_FOLDER}/**/*%s-%d.cor</h3>
                    <ul>
                        <h4>Downloads a replay or shows an error if the replay does not exist.</h4>
                        <li>%d is the game ID as returned by creategame and %s is the game name sent to the api.
                        The replay may be overwritten after 
                        enough time. Returns the replay file.</li>
                        <li>If a game name contains one or more slashes then it is stored in a folder within the replay folder and the returned URL from creategame will show where it is stored.</li>
                    </ul>
                    <p id="bottom"></p>

                    <p>This bot is licenced under <a href="https://github.com/djpiper28/CockatriceTournamentBot/blob/main/LICENCE">GPL 2</a></p>
                    <h3><a href="/api/version">Version info</a> | <a href="/github">Github repo</a> | Monarch Bot by Danny Piper (djpiper28) | Powered by <a href="https://github.com/cesanta/mongoose/">Mongoose</a></h3>
                    </p>
                </div>
            </div>    
        </div>
    </body>
</html>
